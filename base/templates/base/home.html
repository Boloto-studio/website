{% extends "base/layout.html" %}
{% load i18n %}

{% block body %}
<main id="home">
    <section id="hero" class="hero-carousel">
        {% for slide in hero_slides %}
        <article class="hero-slide" data-bg-image="{{ slide.image|escape }}">
            <div class="hero-slide-content">
                <h1>{{ slide.title }}</h1>
                {% if slide.subtitle %}<p>{{ slide.subtitle }}</p>{% endif %}
                {% if slide.link %}<a href="{{ slide.link|escape }}" class="button hero-cta">{{ slide.link_text }}</a>{% endif %}
            </div>
        </article>
        {% endfor %}
        {% if not hero_slides %}
        <article class="hero-slide hero-slide-placeholder">
            <div class="hero-slide-content">
                <h1>{% trans "Welcome to Boloto Studio" %}</h1>
                <p>{% trans "Creating immersive gaming experiences" %}</p>
            </div>
        </article>
        {% endif %}
    </section>
    <script>
        document.querySelectorAll('.hero-slide[data-bg-image]').forEach(function(slide) {
            var url = slide.dataset.bgImage;
            // Validate URL starts with https:// or http:// to prevent javascript: or data: URLs
            // Additional validation: ensure no embedded javascript
            if (url && (url.startsWith('https://') || url.startsWith('http://')) && !url.includes('javascript:')) {
                slide.style.backgroundImage = 'url("' + url.replace(/["\\]/g, '') + '")';
            }
        });
    </script>
    <!-- <div id="hero-divider"></div> -->
    <div id="under-hero">
        <div id="under-hero-left">
            <section id="short-about">
                <div class="fancy-title">
                    <div class="fancy-title-line">
                        <span></span>
                    </div>
                    <h2>{% trans "Us" %}</h2>
                    <div class="fancy-title-line">
                        <span></span>
                    </div>
                </div>
                <p>Holy moly</p>
            </section>
            <section id="events">
                <div class="fancy-title">
                    <div class="fancy-title-line">
                        <span></span>
                    </div>
                    <h2>{% trans "Upcoming events" %}</h2>
                    <div class="fancy-title-line">
                        <span></span>
                    </div>
                </div>
                {% for event in events %}
                <a href="{{event.link}}" class="event no-style">
                    <div class="left">
                        <h2>{{event.title|truncatechars:35}}</h2>
                        <span>{{event.date}}</span>
                    </div>
                    <div class="right"><span class="material-symbols-outlined">videocam</span></div>
                </a>
                {% empty %}
                <h2 style="text-align: center;">{% trans "Something is coming. Soon..." %}</h2>
                {% endfor %}
            </section>
        </div>
        <section id="blog">
            <div class="fancy-title">
                <div class="fancy-title-line">
                    <span></span>
                </div>
                <h2>{% trans "What's going on" %}</h2>
                <div class="fancy-title-line">
                    <span></span>
                </div>
            </div>
            <div id="posts-container">
                {% for post in posts %}
                <div class="blogpost">
                    <div class="blog-bottom">
                        <h1>{{ post.title }}</h1>
                        <span>{{ post.published_date }}</span>
                        <p>{{ post.content|truncatechars:650 }}</p>
                    </div>
                </div>
                {% empty %}
                <h2 style="text-align: center;">{% trans "Keep an eye on updates!" %}</h2>
                {% endfor %}
            </div>
        </section>
    </div>
</main>
{% endblock %}